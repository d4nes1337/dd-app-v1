import{r as d,j as e,V as B,R as V,A as M,C as U,X as xe,T as O,D as H,c as I,P as me,a as J,b as ge,u as pe,d as R,e as he,L as k,H as fe,S as ye,f as be,g as W,h as K,i as je,k as Q,E as ve,l as Y,m as Ne,N as we,n as _e,o as ke,p as Ce,q as F,s as C,t as Se,v as Te,w as ze,J as y,x as Ee,M as $e,y as De,z as Re}from"./vendor-Q2BL7_Gq.js";import{c as m,u as Le,a as G,h as D,g as X,b as Pe,m as qe,s as Ae,d as Fe,e as Be,f as Ve,i as Me,j as Ue,k as Oe,l as He,v as Ie,n as Je}from"./main-CuLhg1N_.js";const We=me,Z=d.forwardRef(({className:s,...a},l)=>e.jsx(B,{ref:l,className:m("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a}));Z.displayName=B.displayName;const Ke=I("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),ee=d.forwardRef(({className:s,variant:a,...l},t)=>e.jsx(V,{ref:t,className:m(Ke({variant:a}),s),...l}));ee.displayName=V.displayName;const Qe=d.forwardRef(({className:s,...a},l)=>e.jsx(M,{ref:l,className:m("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));Qe.displayName=M.displayName;const se=d.forwardRef(({className:s,...a},l)=>e.jsx(U,{ref:l,className:m("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(xe,{className:"h-4 w-4"})}));se.displayName=U.displayName;const te=d.forwardRef(({className:s,...a},l)=>e.jsx(O,{ref:l,className:m("text-sm font-semibold",s),...a}));te.displayName=O.displayName;const re=d.forwardRef(({className:s,...a},l)=>e.jsx(H,{ref:l,className:m("text-sm opacity-90",s),...a}));re.displayName=H.displayName;function ts(){const{toasts:s}=Le();return e.jsxs(We,{children:[s.map(function({id:a,title:l,description:t,action:i,...n}){return e.jsxs(ee,{...n,children:[e.jsxs("div",{className:"grid gap-1",children:[l&&e.jsx(te,{children:l}),t&&e.jsx(re,{children:t})]}),i,e.jsx(se,{})]},a)}),e.jsx(Z,{})]})}const rs=ge,Ye=d.forwardRef(({className:s,sideOffset:a=4,...l},t)=>e.jsx(J,{ref:t,sideOffset:a,className:m("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l}));Ye.displayName=J.displayName;const Ge=()=>{const s=pe(),a=R(),{itemCount:l}=G();he();const t=n=>s.pathname===n,i=n=>o=>{o.preventDefault(),t(n)||(D(),a(n))};return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bottom-nav-bar pb-4",children:e.jsxs("div",{className:"grid grid-cols-3 w-full max-w-md mx-auto h-24",children:[e.jsx(k,{to:"/",onClick:i("/"),className:m("flex items-center justify-center transition-all duration-200",t("/")?"text-telegram-button active":"text-telegram-hint"),"aria-current":t("/")?"page":void 0,children:e.jsx(fe,{size:32})}),e.jsx(k,{to:"/shop",onClick:i("/shop"),className:m("flex items-center justify-center relative transition-all duration-200",t("/shop")?"text-telegram-button active":"text-telegram-hint"),"aria-current":t("/shop")?"page":void 0,children:e.jsxs("div",{className:"relative",children:[e.jsx(ye,{size:32}),l>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full badge",children:l})]})}),e.jsx(k,{to:"/calculator",onClick:i("/calculator"),className:m("flex items-center justify-center transition-all duration-200",t("/calculator")?"text-telegram-button active":"text-telegram-hint"),"aria-current":t("/calculator")?"page":void 0,children:e.jsx(be,{size:32})})]})})},as=({children:s,className:a,fullHeight:l=!1})=>e.jsxs("div",{className:m("w-full pb-52 max-w-md mx-auto",l?"min-h-screen":"",a),style:{backgroundColor:"transparent"},children:[e.jsx("div",{className:"animate-fade-in",children:s}),e.jsx(Ge,{})]}),Xe=({emoji:s,username:a,size:l="md",className:t,randomize:i=!1})=>{const[n,o]=d.useState(s||"😊");d.useEffect(()=>{s?o(s):a?o(X(a,"avatar")):i&&o(Pe())},[s,a,i]);const u={sm:"w-8 h-8 text-lg",md:"w-12 h-12 text-2xl",lg:"w-16 h-16 text-3xl"};return e.jsx("div",{className:m("flex items-center justify-center rounded-full bg-telegram-light animate-pulse-slow",u[l],t),children:e.jsx("span",{className:"animate-float",children:n})})},ls=({user:s,emoji:a,size:l="md",className:t=""})=>{const n={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"}[l];return s!=null&&s.photo_url?e.jsx("div",{className:`${n} rounded-full overflow-hidden ${t}`,children:e.jsx("img",{src:s.photo_url,alt:`${s.first_name}'s profile`,className:"w-full h-full object-cover",onError:o=>{console.error("Error loading profile image, falling back to emoji avatar"),o.currentTarget.style.display="none"}})}):e.jsx(Xe,{emoji:a,size:l,className:t})},ns=({size:s="md",className:a,fillColor:l="fill-telegram-blue"})=>{const t={sm:"w-6 h-6",md:"w-10 h-10",lg:"w-16 h-16"};return e.jsx("div",{className:"flex justify-center items-center",children:e.jsxs("svg",{className:m("animate-spin",t[s],a),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:l,d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})},is=({banners:s,className:a="",autoPlayInterval:l=5e3})=>{const t=R(),i=n=>{n.link&&(n.external?window.open(n.link,"_blank","noopener,noreferrer"):t(n.link))};return!s||s.length===0?null:e.jsxs("div",{className:`banner-swiper-container w-full relative ${a}`,children:[e.jsx(W,{modules:[K,je,Q,ve],spaceBetween:0,slidesPerView:1,pagination:{clickable:!0,type:"bullets",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",el:".banner-pagination"},navigation:!1,autoplay:{delay:l,disableOnInteraction:!1},loop:s.length>1,effect:"slide",className:"w-full aspect-[2.5/1]",children:s.map((n,o)=>e.jsx(Y,{className:"w-full h-full cursor-pointer",onClick:()=>i(n),children:e.jsx("div",{className:"w-full h-full bg-cover bg-center rounded-lg",style:{backgroundImage:`url(${n.image})`}})},o))}),e.jsx("div",{className:"banner-pagination flex justify-center mt-2"})]})},os=()=>e.jsxs("a",{href:"https://t.me/dd_helper",target:"_blank",rel:"noopener noreferrer",className:"bg-cover bg-center rounded-lg p-4 shadow-sm hover-lift flex flex-col justify-between transform hover:-translate-y-1 hover:shadow-md transition-all duration-300",style:{backgroundImage:`url(${qe})`},children:[e.jsx("div",{children:e.jsx("h3",{className:"text-xl font-medium text-black/80",children:"DD MANAGER"})}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("p",{className:"text-xs text-black/50",children:"Поможет определиться с цветом и размером"})}),e.jsx("div",{className:"flex justify-end mt-1",children:e.jsx(Ne,{size:20,className:"text-white"})})]}),cs=({product:s,className:a})=>{const l=R(),t=X(`${s.item_name}-${s.color_code}`,"product"),i=Array.isArray(s.sizes)?Ae(s.sizes.filter(c=>c.quantity>0).map(c=>c.size)):[],n=s.photos&&s.photos.length>0,o=()=>{if(!n)return"";const c=s.photos.find(r=>r.photo_category==="front"&&r.photo_url);return c?c.photo_url:s.photos[0].photo_url},u=c=>{c.preventDefault(),Fe("medium"),l(`/product/${s.sku}`)};return e.jsxs(k,{to:`/product/${s.sku}`,onClick:u,className:m("block bg-telegram-secondary-bg rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all duration-300 hover-lift",a),children:[e.jsx("div",{className:"aspect-square bg-telegram-bg flex items-center justify-center",children:n?e.jsx("img",{src:o(),alt:s.item_name,className:"w-full h-full object-cover",onError:c=>{c.currentTarget.style.display="none",c.currentTarget.parentElement.innerHTML=`<span class="text-5xl animate-float">${t}</span>`}}):e.jsx("span",{className:"text-5xl animate-float",children:t})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:"font-medium text-telegram-text truncate",children:s.item_name}),s.brand&&e.jsx("span",{className:"text-xs text-telegram-hint bg-telegram-bg px-2 py-0.5 rounded-full",children:s.brand})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-telegram-hint",children:["Color: ",s.color_code]}),e.jsxs("span",{className:"font-medium text-telegram-button",children:["₽",typeof s.price_rub=="string"?parseFloat(s.price_rub).toLocaleString():s.price_rub.toLocaleString()]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[i.slice(0,3).map(c=>e.jsx("span",{className:"text-xs px-2 py-1 bg-telegram-bg text-telegram-text rounded-full",children:c},c)),i.length>3&&e.jsxs("span",{className:"text-xs px-2 py-1 bg-telegram-bg text-telegram-text rounded-full",children:["+",i.length-3]})]})]})]})},ds=({availableSizes:s,selectedSize:a,onChange:l,className:t})=>{const i=n=>{l(n)};return e.jsxs("div",{className:m("w-full",t),children:[e.jsx("h3",{className:"text-sm font-medium text-telegram-text mb-2",children:"Выберите размер"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(n=>e.jsx("button",{className:m("px-4 py-2 rounded-full border transition-all duration-200",a===n?"border-telegram-button bg-telegram-button/10 text-telegram-button":"border-telegram-hint/30 bg-telegram-bg text-telegram-text hover:border-telegram-hint/50"),onClick:()=>i(n),children:n},n))})]})},us=({photos:s,productName:a,fallbackEmoji:l="📦",className:t=""})=>{const[i,n]=d.useState(0),o=u=>{const c=u.currentTarget;if(c.style.display="none",c.parentElement){const r=document.createElement("div");r.className="w-full h-full flex items-center justify-center",r.innerHTML=`<span class="text-8xl animate-float">${l}</span>`,c.parentElement.appendChild(r)}};return!s||s.length===0?e.jsx("div",{className:`w-full aspect-square bg-telegram-bg flex items-center justify-center ${t}`,children:e.jsx("span",{className:"text-8xl animate-float",children:l})}):e.jsxs("div",{className:`photo-swiper-container w-full aspect-square bg-telegram-bg relative ${t}`,children:[e.jsx(W,{modules:[K,we,Q],spaceBetween:0,slidesPerView:1,pagination:{clickable:!0,type:"bullets",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active"},navigation:!0,onSlideChange:u=>{n(u.activeIndex)},className:"w-full h-full",children:s.map((u,c)=>e.jsx(Y,{className:"w-full h-full",children:e.jsx("img",{src:u,alt:`${a} - ${c+1}`,className:"w-full h-full object-cover",onError:o})},c))}),s.length>1&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 bg-black/40 rounded-full px-3 py-1 z-10",children:e.jsxs("span",{className:"text-white text-xs",children:[i+1," / ",s.length]})})]})},Ze=I("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function $({className:s,variant:a,...l}){return e.jsx("div",{className:m(Ze({variant:a}),s),...l})}const xs=({order:s})=>{const[a,l]=d.useState(!1),t={...s,delivery_type:s.delivery_type||"",delivery_price:s.delivery_price||"0",delivery_address:s.delivery_address||null,delivery_info:s.delivery_info||null,delivery_code:s.delivery_code||null,items:s.items.map(r=>({...r,id:typeof r.id=="number"?r.id:0,type:r.type||"stock",status:r.status||s.status||"",dewu_url:r.dewu_url||null,shipping_type:r.shipping_type||null,category_type:r.category_type||null,weight_category:r.weight_category||null,color_code:r.color_code||null,sku:r.sku||null,item_name:r.item_name||null,size:r.size||"",price_cny:r.price_cny||null,price_rub:r.price_rub||null,sale_price:r.sale_price||null,quantity:r.quantity||1}))},i=r=>{switch(r.toLowerCase()){case"delivered":case"доставлен":return"bg-green-500";case"awaiting manager":case"ожидает менеджера":return"bg-yellow-500";case"awaiting purchase":case"ожидает покупки":return"bg-blue-500";case"cancelled":case"отменён":return"bg-red-500";default:return"bg-gray-500"}},n=r=>{switch(r.toLowerCase()){case"delivered":return"Доставлен";case"awaiting manager":return"Ожидает менеджера";case"awaiting purchase":return"Ожидает покупки";case"cancelled":return"Отменён";default:return r}},o=r=>r?(typeof r=="string"?parseFloat(r):r).toLocaleString("ru-RU",{maximumFractionDigits:2}):"0",u=r=>new Date(r).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=r=>r%10===1&&r%100!==11?"товар":[2,3,4].includes(r%10)&&![12,13,14].includes(r%100)?"товара":"товаров";return e.jsxs("div",{className:"bg-white dark:bg-sidebar-accent rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-sidebar-primary/10 transition-colors",onClick:()=>l(!a),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"text-lg font-medium",children:["Заказ #",t.order_id]}),e.jsx($,{className:`${i(t.status)} text-white`,children:n(t.status)})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:u(t.created_at)}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[t.items.length," ",c(t.items.length)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium text-lg",children:["₽",o(t.final_price)]}),t.promocode&&e.jsx("p",{className:"text-sm text-telegram-blue",children:t.promocode.promocode_text}),e.jsx("button",{className:"mt-2 text-telegram-blue hover:text-telegram-dark transition-colors","aria-label":a?"Свернуть детали":"Развернуть детали",children:a?e.jsx(_e,{size:20}):e.jsx(ke,{size:20})})]})]})}),a&&e.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800/50",children:e.jsxs("div",{className:"p-4 space-y-4",children:[t.items.map((r,p)=>e.jsx("div",{className:"border-b dark:border-gray-700 pb-3 last:border-0",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-1",children:[e.jsx($,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:r.type==="stock"?"Сток":"Предзаказ"}),r.status&&e.jsx($,{className:`${i(r.status)} text-white`,children:n(r.status)})]}),e.jsx("p",{className:"font-medium",children:r.item_name||(r.dewu_url?e.jsxs("a",{href:r.dewu_url,target:"_blank",rel:"noopener noreferrer",className:"text-telegram-blue hover:underline flex items-center",children:[r.dewu_url.substring(0,30),r.dewu_url.length>30?"...":"",e.jsx(Ce,{size:14,className:"ml-1"})]}):"Товар")}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Размер: ",r.size," ",r.quantity>1&&`× ${r.quantity}`]}),r.type==="preorder"&&r.price_cny&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Цена (юани): ¥",o(r.price_cny)]}),r.sku&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Артикул: ",r.sku]}),r.shipping_type&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Тип доставки: ",r.shipping_type]}),r.category_type&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Категория: ",r.category_type]}),r.weight_category&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Вес: ",r.weight_category]}),r.color_code&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:"Цвет:"}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:r.color_code}})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-medium",children:["₽",o(r.price_rub)]})})]})},`item-${p}-${r.id}`)),e.jsxs("div",{className:"pt-3 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Сумма товаров"}),e.jsxs("span",{children:["₽",o(t.subtotal)]})]}),t.delivery_code&&e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Доставка: ",t.delivery_code]}),e.jsx("span",{children:t.delivery_price==="0"?"Бесплатно":`₽${o(t.delivery_price)}`})]}),t.promocode&&e.jsxs("div",{className:"flex justify-between text-sm text-telegram-blue mb-1",children:[e.jsxs("span",{children:["Промокод: ",t.promocode.promocode_text,t.promocode.discount_percent&&t.promocode.discount_percent!=="null"&&` (-${t.promocode.discount_percent}%)`,t.promocode.discount_fixed&&` (-${t.promocode.discount_fixed}₽)`]}),e.jsxs("span",{children:["-₽",o(t.discount_amount)]})]}),t.discount_amount&&t.discount_amount!=="0"&&!t.promocode&&e.jsxs("div",{className:"flex justify-between text-sm text-telegram-blue mb-1",children:[e.jsx("span",{children:"Скидка"}),e.jsxs("span",{children:["-₽",o(t.discount_amount)]})]}),t.dd_coins_used&&t.dd_coins_used!=="0"&&e.jsxs("div",{className:"flex justify-between text-sm text-yellow-500 mb-1",children:[e.jsx("span",{children:"Использовано DD Коинов"}),e.jsxs("span",{children:["-₽",o(t.dd_coins_used)]})]}),t.prepay_amount&&t.prepay_amount!=="0"&&e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Предоплата"}),e.jsxs("span",{children:["₽",o(t.prepay_amount)]})]}),e.jsxs("div",{className:"flex justify-between font-medium text-base mt-2",children:[e.jsx("span",{children:"Итого"}),e.jsxs("span",{children:["₽",o(t.final_price)]})]})]})]})})]})},ms=({className:s})=>{const[a,l]=d.useState(null),[t,i]=d.useState(!0),{data:n,refetch:o}=F({queryKey:["referralInfo"],queryFn:()=>Be(),staleTime:60*1e3,retry:1,retryDelay:1e3}),{data:u,refetch:c}=F({queryKey:["referralStats"],queryFn:()=>Ve(),staleTime:60*1e3,retry:1,retryDelay:1e3});d.useEffect(()=>{(async()=>{i(!0),l(null);try{await Promise.all([o(),c()])}catch(N){console.error("Error loading referral data:",N),l("Failed to load referral information")}finally{i(!1)}})()},[o,c]);const r=async()=>{n&&await Me(n)},p=async()=>{if(n)try{await navigator.clipboard.writeText(n.telegram_deep_link),y.success("Referral link copied to clipboard")}catch(f){console.error("Error copying to clipboard:",f),y.error("Failed to copy referral link")}},h=()=>{i(!0),l(null),Promise.all([o(),c()]).finally(()=>i(!1))};return t?e.jsxs("div",{className:`p-4 text-center ${s}`,children:[e.jsx(C,{className:"animate-spin mx-auto h-6 w-6 text-telegram-blue"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Loading referral information..."})]}):a?e.jsxs("div",{className:`p-4 text-center ${s}`,children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-2",children:a}),e.jsxs("button",{onClick:h,className:"inline-flex items-center text-sm text-telegram-blue hover:text-telegram-dark",children:[e.jsx(Se,{className:"mr-1 h-4 w-4"}),"Retry"]})]}):e.jsxs("div",{className:`space-y-4 ${s}`,children:[e.jsxs("div",{className:"p-4 bg-telegram-secondary-bg rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Your Referral Link"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:(n==null?void 0:n.telegram_deep_link)||"",className:"flex-1 p-2 text-sm bg-white dark:bg-sidebar-primary/30 border border-gray-300 dark:border-gray-700 rounded-md"}),e.jsx("button",{onClick:p,className:"p-2 text-telegram-blue hover:text-telegram-dark",title:"Copy link",children:e.jsx(Te,{size:18})}),e.jsx("button",{onClick:r,className:"p-2 text-telegram-blue hover:text-telegram-dark",title:"Share link",children:e.jsx(ze,{size:18})})]})]}),e.jsxs("div",{className:"p-4 bg-telegram-secondary-bg rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Your Referrals"}),u!=null&&u.referred_users&&u.referred_users.length>0?e.jsx("div",{className:"space-y-2",children:u.referred_users.map(f=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:f.username?`@${f.username}`:`User ${f.id}`}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["Joined ",new Date(f.joined_at).toLocaleDateString()]})]},f.id))}):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No referrals yet. Share your link to start earning rewards!"})]})]})},gs=({initialEmail:s="",initialPhone:a="",initialAddress:l="",clientInfo:t=null,onComplete:i,onCancel:n})=>{const[o,u]=d.useState((t==null?void 0:t.email)||s),[c,r]=d.useState((t==null?void 0:t.phone_number)||a),[p,h]=d.useState((t==null?void 0:t.address)||l),[f,N]=d.useState(!1),[S,ae]=d.useState([]),[b,L]=d.useState(""),[P,q]=d.useState(!1),le=!!(o&&c&&p);d.useEffect(()=>{const x=async()=>{q(!0);try{const g=await Ue();if(ae(g),g.length>0){const ce=g.find(E=>E.delivery_type==="courier"),de=g.find(E=>E.delivery_type==="shipping"),ue=ce||de||g[0];L(ue.delivery_type)}}catch(g){console.error("Failed to load delivery types:",g)}finally{q(!1)}},v=async()=>{if(!t)try{const g=await Oe();g&&(u(g.email||""),r(g.phone_number||""),h(g.address||""))}catch(g){console.error("Error fetching client info:",g)}};x(),v()},[t]);const T=S.find(x=>x.delivery_type===b),ne=T?{delivery_type:T.delivery_type,price_rub:T.price_rub}:void 0,j=b==="self_pickup",[z,A]=d.useState("");d.useEffect(()=>{const x=(t==null?void 0:t.address)||l;x&&A(x)},[l,t]),d.useEffect(()=>{h(j?"Москва, Ильменский проезд, 14к8":z)},[j,z]);const ie=x=>{const v=x.target.value;h(v),j||A(v)},oe=async x=>{x.preventDefault(),N(!0);try{if(!o||!c||!b){alert("Please fill in all required fields"),N(!1);return}await He(c,o,j?z:p)?i(ne):y.error("Failed to update client information")}catch(v){console.error("Error updating client info:",v),y.error("Failed to update client information")}finally{N(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/30 dark:bg-black/50 flex items-start justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white dark:bg-sidebar-accent rounded-lg shadow-lg max-w-md w-full my-8",children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Заполните свои данные"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:le?"Пожалуйста, проверьте свои контактные данные.":"Нам нужны ваши контактные данные для обработки заказа."})]}),e.jsxs("form",{onSubmit:oe,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Электронная почта ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",value:o,onChange:x=>u(x.target.value),className:"w-full p-2 border border-gray-300 dark:border-gray-700 rounded dark:bg-sidebar-primary",placeholder:"ваша@почта.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Номер телефона ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:c,onChange:x=>r(x.target.value),className:"w-full p-2 border border-gray-300 dark:border-gray-700 rounded dark:bg-sidebar-primary",placeholder:"+7 (999) 123-4567",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Способ доставки ",e.jsx("span",{className:"text-red-500",children:"*"})]}),P?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Загрузка вариантов доставки..."})]}):S.length===0?e.jsx("div",{className:"text-red-500",children:"Ошибка загрузки вариантов доставки. Пожалуйста, попробуйте позже."}):e.jsx("div",{className:"grid gap-2",children:S.map(x=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${b===x.delivery_type?"border-telegram-blue bg-telegram-blue/10":"border-gray-300 dark:border-gray-700"}`,onClick:()=>L(x.delivery_type),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:x.delivery_code}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:x.delivery_info})]}),e.jsx("div",{className:"text-telegram-blue font-medium",children:x.price_rub>0?`₽${x.price_rub}`:"Бесплатно"})]})},x.delivery_type))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Адрес доставки ",(b==="courier"||b==="shipping")&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:p,onChange:ie,className:`w-full p-2 border rounded resize-none h-24 ${j?"bg-gray-100 dark:bg-gray-800":"bg-white dark:bg-sidebar-primary"} dark:border-gray-700`,placeholder:"Укажите ваш полный адрес",disabled:j,required:b==="courier"||b==="shipping"}),j&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"При самовывозе заказ можно забрать по указанному адресу"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t dark:border-gray-700",children:[n&&e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md",disabled:f,children:"Отмена"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium bg-telegram-blue text-white rounded-md hover:bg-blue-600 disabled:opacity-50",disabled:f||!o||!c||P||!b||(b==="courier"||b==="shipping")&&!p,children:f?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"inline-block mr-2 h-4 w-4 animate-spin"}),"Сохранение..."]}):"Продолжить"})]})]})]})})},ps=({item:s,onRemove:a})=>{const{updateQuantity:l}=G(),t=()=>{D(),l(s.productId,s.size,s.quantity+1)},i=()=>{D(),s.quantity>1?l(s.productId,s.size,s.quantity-1):a()},n=()=>s.item_type==="preorder"?s.category_type==="sneakers"?"👟":s.category_type==="clothes"?"👕":s.category_type==="accessories"?"👜":s.category_type==="shirt"?"👕":"🔮":"👕";return e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-white dark:bg-sidebar-accent rounded-lg shadow-sm",children:[e.jsx("div",{className:"flex-shrink-0 w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-md flex items-center justify-center text-4xl overflow-hidden",children:s.photo_url?e.jsx("img",{src:s.photo_url,alt:s.name,className:"w-full h-full object-cover",onError:o=>{o.currentTarget.style.display="none",o.currentTarget.parentElement.innerHTML=n()}}):n()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:s.name}),e.jsx("button",{onClick:a,className:"text-red-500 hover:text-red-700","aria-label":"Remove item",children:e.jsx(Ee,{size:16})})]}),s.item_type==="preorder"?e.jsxs("div",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{className:"truncate",children:["URL: ",s.dewu_url]}),e.jsxs("p",{children:["Размер: ",s.size||"Не указан"]}),e.jsxs("p",{children:["Категория: ",s.category_type==="sneakers"?"Обувь":s.category_type==="clothes"?"Одежда":s.category_type==="accessories"?"Аксессуары":s.category_type==="shirt"?"Рубашка":s.category_type]}),e.jsxs("p",{children:["Доставка: ",(s.shipping_type||s.delivery_type)==="cargo"?"Автомобиль":"Самолет"]})]}):e.jsxs("div",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("p",{children:s.color&&`Цвет: ${s.color}`}),e.jsxs("p",{children:["Размер: ",s.size]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"text-sm font-medium text-telegram-blue",children:["₽",(s.sale_price||s.price).toLocaleString()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:i,className:"p-1 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Decrease quantity",children:e.jsx($e,{size:14})}),e.jsx("span",{className:"text-sm font-medium w-6 text-center",children:s.quantity}),e.jsx("button",{onClick:t,className:"p-1 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Increase quantity",children:e.jsx(De,{size:14})})]})]})]})]})},hs=({className:s,originalPrice:a,onPromocodeApplied:l,onPromocodeRemoved:t,currentPromocode:i})=>{const[n,o]=d.useState(""),[u,c]=d.useState(!1),r=async p=>{if(p.preventDefault(),!n.trim()){y.error("Пожалуйста, введите промокод");return}c(!0);try{const h=await Ie(n.trim());if(h.success&&h.promocode){const f=Je(a,h.promocode);l(h.promocode,f),y.success("Промокод успешно применен!")}else y.error(h.message||"Недействительный промокод")}catch(h){console.error("Error validating promocode:",h),y.error("Не удалось проверить промокод")}finally{c(!1)}};return i?e.jsxs("div",{className:`flex items-center justify-between p-3 bg-telegram-secondary-bg rounded-lg ${s}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"text-telegram-blue",size:16}),e.jsx("span",{className:"text-sm font-medium",children:i.promocode_text})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:i.discount_fixed?`-${i.discount_fixed}₽`:i.discount_percent&&i.discount_percent!=="null"?`-${i.discount_percent}%`:""}),e.jsx("button",{onClick:t,className:"text-sm text-red-500 hover:text-red-600",children:"Удалить"})]})]}):e.jsxs("form",{onSubmit:r,className:`flex gap-2 ${s}`,children:[e.jsx("input",{type:"text",value:n,onChange:p=>o(p.target.value),placeholder:"Введите промокод",className:"flex-1 p-2 text-sm bg-white dark:bg-sidebar-primary/30 border border-gray-300 dark:border-gray-700 rounded-md",disabled:u}),e.jsx("button",{type:"submit",disabled:u||!n.trim(),className:"px-4 py-2 bg-telegram-blue text-white rounded-md disabled:opacity-70 flex items-center",children:u?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:16,className:"animate-spin mr-2"}),"Проверка..."]}):"Применить"})]})},w=()=>{var s,a;if((a=(s=window.Telegram)==null?void 0:s.WebApp)!=null&&a.themeParams){const l=window.Telegram.WebApp.themeParams;return{bg:l.bg_color||"#ffffff",text:l.text_color||"#000000",hint:l.hint_color||"#999999",link:l.link_color||"#2481cc",button:l.button_color||"#3390ec",buttonText:l.button_text_color||"#ffffff",secondaryBg:l.secondary_bg_color||"#f0f0f0"}}return{bg:"#ffffff",text:"#000000",hint:"#999999",link:"#2481cc",button:"#3390ec",buttonText:"#ffffff",secondaryBg:"#f0f0f0"}},_={error:s=>{const a=w();return y.error(s,{style:{backgroundColor:a.bg,color:a.text,border:"1px solid rgba(239, 68, 68, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},cancel:{label:"Закрыть",onClick:()=>{}}})},success:s=>{const a=w();return y.success(s,{style:{backgroundColor:a.bg,color:a.text,border:"1px solid rgba(34, 197, 94, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},cancel:{label:"Закрыть",onClick:()=>{}}})},info:s=>{const a=w();return y.info(s,{style:{backgroundColor:a.bg,color:a.text,border:"1px solid rgba(59, 130, 246, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},cancel:{label:"Закрыть",onClick:()=>{}}})},warning:s=>{const a=w();return y.warning(s,{style:{backgroundColor:a.bg,color:a.text,border:"1px solid rgba(234, 179, 8, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},cancel:{label:"Закрыть",onClick:()=>{}}})}},fs={...y,error:_.error,success:_.success,info:_.info,warning:_.warning};export{is as B,ps as C,os as D,ns as L,xs as O,as as P,ms as R,ds as S,rs as T,ls as U,cs as a,us as b,hs as c,gs as d,ts as e,fs as t};
//# sourceMappingURL=components-NgyWMzTU.js.map
